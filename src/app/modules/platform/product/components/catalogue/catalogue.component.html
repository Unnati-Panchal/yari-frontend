<main>
  <section class="left-image">
    <ng-container>
      <h1>Upload Product Catalogue</h1>
      <div class="red-line"></div>
    </ng-container>
  </section>
  <section class="buttons-container">

    <div class="download-container">
      <section>
        <mat-form-field appearance="outline">
          <mat-label>Choose Category</mat-label>
          <mat-select [(ngModel)]="selectedCategory" (ngModelChange)="isSelectedCategory($event)">
            <ng-container *ngIf="getCategories$ | async as categories">
              <mat-option *ngFor="let category of categories" [value]="category">{{category.name}}</mat-option>
            </ng-container>
          </mat-select>
        </mat-form-field>
        <p>{{selectedCategoryMsg}}</p>
      </section>
      <section class="download-btn">
        <button *ngIf="!downloadLoading else LoadingSpinner"
                mat-button (click)="downloadTemplate()">Download</button>
        <ng-template #LoadingSpinner>
          <button mat-button>
            <mat-spinner [diameter]="25"></mat-spinner>
          </button>
        </ng-template>
      </section>
    </div>

    <div class="selected-category">
      <p *ngIf="categoriesChain?.length">
        Selected category:
        <span *ngFor="let category of categoriesChain">
          {{category.name}}
          <span *ngIf="!category.isLast"> > </span>
        </span>
      </p>
    </div>

    <div class="upload-container">
      <div class="upload-section" appDnd (fileDropped)="onFileDropped($event)">
        <input type="file" style="display: none" #fileDropRef id="fileDropRef" (change)="fileBrowseHandler($event.target.files)" />
        <img [src]="'assets/images/drag_files.svg'" alt="drag image here"/>
        <h3>Drag files here or choose browse to select files</h3>
      </div>
      <app-error-success [errors]="getIsError$ | async" [success]="success"></app-error-success>
    </div>

    <div class="form-catalogue-name">
      <form [formGroup]="uploadForm">
        <h4>Catalogue Name<span class="required">*</span></h4>
        <mat-form-field appearance="outline" class="small-form-group">
          <mat-label>Enter your catalogue name</mat-label>
          <input matInput formControlName="catalogue_name" autocomplete="nope">
          <mat-error *ngIf="uploadForm.controls['catalogue_name'].hasError('required')">Required field</mat-error>
        </mat-form-field>
      </form>
    </div>

    <div class="buttons-box">
      <div>
        <button mat-button class="outlined-btn" (click)="fileDropRef.click()">
          <span>Browse</span>
        </button>
      </div>
      <div>
        <button *ngIf="!uploadLoading else LoadingSpinner"
                mat-button (click)="upload()">Upload</button>
        <ng-template #LoadingSpinner>
          <button mat-button>
            <mat-spinner [diameter]="25"></mat-spinner>
          </button>
        </ng-template>
      </div>
    </div>
  </section>
</main>
